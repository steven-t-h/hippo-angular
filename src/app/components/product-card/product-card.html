@let forceMyacPricing = forceMyAccountPricing$;

<main class="product-card min-h-[660px] h-full w-full rounded-[40px] shadow-lg bg-white flex flex-col gap-4 mx-auto overflow-hidden max-w-[400px]">
  <section class="product-card__image-section h-[310px] relative cursor-pointer" (click)="onNavigateToPage(productSlug())">
    <a
      [routerLink]="['/' + productSlug]"
      [queryParamsHandling]="'merge'"
    >
      <div class="product-card__tag-row absolute top-5 left-6 gap-1 flex">
        <ng-container *ngFor="let tag of tagLabels(); let i = index">
          <p [ngStyle]="{ 'background-color': tag.color}" class="product-card__tag text-xs font-semibold text-[#13161d] rounded-full py-2 px-4 uppercase md:text-md">{{ tag.label }}</p>
        </ng-container>
      </div>
      <img class="object-cover object-center h-full" src="{{image()}}" [alt]="name()">
    </a>
  </section>
  @if (product()){
    <section class="product-card__content-section flex flex-col h-1/2 gap-2 px-6 pb-7">
      <p class="font-semibold text-xl" [innerHTML]="name()"></p>
      @if (reviewCount() > 0 && rating() > 3){
        <div class="product-card__reviews flex h-6 justify-start items-center">
          <!--        <reviews-stars-->
          <!--          [reviewCount]="reviewCount"-->
          <!--          [rating]="rating"-->
          <!--        >-->
          <!--        </reviews-stars>-->
          <div class="ml-2">
            {{ reviewCount() }} reviews
          </div>
        </div>

      }
      <div class="product-card__description">
        <p class="font-semibold max-h-16 line-clamp-2" [innerHTML]="description()"></p>
      </div>
      <!--
        This means they are using a referral code that enables my account pricing for guests
        we need to modify what is display here when that is true.
      -->
      @if(forceMyacPricing) {
        <div class="product-card__pricing flex justify-between mt-auto" *ngIf="locale && product">
          <div class="product-card__pricing-guest flex flex-col gap-2 text-center">
            <p class="text-xs font-semibold bg-gray-200 rounded-full p-2 uppercase">{{ guestPriceLabel() }}</p>
            <p class="font-semibold text-xl text-nowrap line-through">{{ product()!.products.oneTime.standard[0].localePrice | currency: (locale.currencyCode) }}</p>
          </div>
          <div class="product-card__pricing-member flex flex-col gap-2 text-center">
            <p class="text-xs font-semibold bg-[#ffe9d6] text-[#892100] rounded-full p-2 uppercase">{{ referralPriceLabel() }}</p>
            <p class="font-semibold text-xl text-[#892100] text-nowrap">{{ product()!.products.oneTime.myAccount[0].localePrice | currency: (locale.currencyCode) }}</p>
          </div>
        </div>
      } @else {
        <div class="product-card__pricing flex justify-between mt-auto" *ngIf="locale && product">
          <div class="product-card__pricing-guest flex flex-col gap-2 text-center">
            <p class="text-xs font-semibold bg-gray-200 rounded-full p-2 uppercase">{{ guestPriceLabel() }}</p>
            <p class="font-semibold text-xl text-nowrap">{{ product()!.products.oneTime.standard[0].localePrice | currency: (locale.currencyCode) }}</p>
          </div>
          <div class="product-card__pricing-member flex flex-col gap-2 text-center">
            <p class="text-xs font-semibold bg-[#ffe9d6] text-[#892100] rounded-full p-2 uppercase">{{ priceLabel() }}</p>
            <p class="font-semibold text-xl text-[#892100] text-nowrap">{{ product()!.products.oneTime.myAccount[0].localePrice | currency: (locale.currencyCode) }}</p>
          </div>
        </div>
      }

      @if(!isLoggedIn && showLoginButton) {
        <div class="product-card__button-container flex justify-center w-full">
          <a
            [routerLink]="'/login'"
            [queryParamsHandling]="'merge'"
            class="product-card__login-button button uppercase text-xs text-center leading-6 font-semibold w-full border-[#892100] border-2 bg-[#ffe9d6] text-[#892100] px-4 py-2 rounded-full hover:bg-[#892100] hover:text-white"
            [innerHTML]="loginButtonText">
          </a>
        </div>
      }
      <div class="product-card__button-container flex justify-center w-full">
        <a
          [routerLink]="['/' + productSlug]"
          [queryParamsHandling]="'merge'"
          class="product-card__learn-more-button button uppercase text-center font-semibold w-full border-[#d1dff7] border-2 bg-[#e8f4ff] text-[#2945b8] px-4 py-2 rounded-full hover:bg-[#2945b8] hover:text-white"
          [innerHTML]="productLinkLabel()">
          >
        </a>
      </div>
      @if(product()?.outOfStock) {
        <div class="product-card__button-container flex justify-center w-full">
          <p class="uppercase text-errorColor" [innerHTML]="outOfStockText"></p>
        </div>
      } @else if(showAddToCartButton() && product()) {
        <div class="product-card__button-container flex justify-center w-full">
          <button
            (click)="onAddToCartClicked(product()!, isLoggedIn)"
            class="product-card__add-to-cart-button uppercase button font-semibold w-full border-[#d1dff7] border-2 bg-[#e8f4ff] text-[#2945b8] px-4 py-2 rounded-full hover:bg-[#2945b8] hover:text-white">
            {{ addToCartLabel() }}
          </button>
        </div>
      }
    </section>
  }
</main>
